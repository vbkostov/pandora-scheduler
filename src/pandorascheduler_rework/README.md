# Pandora Scheduler Rework - Codebase Map

This directory contains the refactored scheduler implementation. Here is a guide to the structure and key files.

## üìÇ Directory Structure

### `src/pandorascheduler_rework/`
The main package containing all source code.

*   **`scheduler.py`**: **CORE LOGIC**. Contains the main scheduling loop (`run_scheduler`). Decides *what* to observe and *when*.
*   **`science_calendar.py`**: **OUTPUT GENERATOR**. Converts the schedule into the XML format required by the spacecraft.
*   **`pipeline.py`**: **ENTRY POINT**. Orchestrates the entire process (Data Load -> Visibility -> Schedule -> Output). Contains `build_schedule`.
*   **`config.py`**: **CONFIGURATION**. The new unified configuration system (`PandoraSchedulerConfig`).
*   **`observation_utils.py`**: **HELPERS**. Domain-specific helpers for observation sequences and coordinates.


### Subdirectories

*   **`visibility/`**: **GEOMETRY & PHYSICS**.
    *   Calculates what the satellite can see.
    *   Handles GMAT ephemeris files and coordinate transformations.
    *   Key file: `catalog.py` (generates visibility windows).

*   **`utils/`**: **GENERIC UTILITIES**.
    *   Helper functions that are not specific to the scheduler domain.
    *   `io.py`: File I/O and caching utilities.
    *   `array_ops.py`: NumPy array manipulation.
    *   `string_ops.py`: String processing.
    *   `time.py`: Time conversion helpers.

*   **`data/`** (Runtime):
    *   Generated by the pipeline. Contains visibility files and target lists.

## üîë Key Functions

| Goal | Function | File |
|------|----------|------|
| **Run the Scheduler** | `build_schedule(config)` | `pipeline.py` |
| **Configure a Run** | `PandoraSchedulerConfig(...)` | `config.py` |
| **Scheduling Logic** | `run_scheduler(...)` | `scheduler.py` |
| **Generate XML** | `generate_science_calendar(...)` | `science_calendar.py` |
| **Calculate Visibility** | `build_visibility_catalog(...)` | `visibility/catalog.py` |

## ‚öôÔ∏è Configuration

We are transitioning to a unified configuration system.

**Old Way (Deprecated but working):**
Using dictionaries and multiple config classes (`SchedulerConfig`, `VisibilityConfig`).

**New Way (Recommended):**
Using `PandoraSchedulerConfig` in `config.py`.

```python
from pandorascheduler_rework.config import PandoraSchedulerConfig
from pandorascheduler_rework.pipeline import build_schedule

config = PandoraSchedulerConfig(
    window_start=...,
    window_end=...,
    targets_manifest=...
)
result = build_schedule(config)
```
